---
layout: post
title: Use Azure B2B direct federation for a merger scenario
date: 2019-07-12 14:09:54.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Authentication
- Azure AD
- Migration
tags:
- ADFS
- B2B
- Collaboration
- Federation
- Identity
- IdP
- M&amp;A
- Merge
- SAML 2.0
- Shibboleth
- WS-Fed
meta:
  _wpas_skip_20268272: '1'
  _publicize_job_id: '32766487183'
  timeline_notification: '1562933396'
  publicize_linkedin_url: ''
  _publicize_done_21846260: '1'
  _wpas_done_22590086: '1'
  _thumbnail_id: '42'
author:
  login: cbaumgartner80
  email: wordpress@treegardner.de
  display_name: cbag
  first_name: Christian
  last_name: Baumgartner
permalink: "/2019/07/12/use-azure-b2b-direct-federation-for-a-merger-scenario/"
excerpt: In this article you will learn how to use the new Azure B2B direct federation
  feature to quickly integrate your next M&A challenge.
---
<p><!-- wp:paragraph --></p>
<p>In Jule 2019 Microsoft announced the public preview for a new and awesome feature: </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:quote --></p>
<blockquote class="wp-block-quote"><p>Azure B2B direct federation. </p>
</blockquote>
<p><!-- /wp:quote --></p>
<p><!-- wp:paragraph --></p>
<p>In short: This feature lets you establish a federation trust between an existing Azure AD tenant an an identity provider (IdP). </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>The good news is that this IdP does not need to be ADFS! Instead it can be anything that is compatible with SAML 2.0 or WS-Fed (for WS-Fed currently only ADFS and Shibboleth are successful testest by Microsoft). So technically you can build a trust between almost any IdP on the market (in theory :-D)</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>The main purpose of this feature is to lower the bars for working together with a partner company more closely even if this partner is not using Azure AD for AuthN. You may think, that using Azure B2B is no big deal even when you don't have Azure AD running at your partner organisations, but  redeeming invitations, creating LiveIDs etc. can be challenging for a large user base. Also the users in the partner org suffer SSO when relying on Live IDs or OTP flows.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>In this case the direct fedartion can tighten the collaboration and streamline the process for AuthN/AuthZ</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading --></p>
<h2>Migration scenario with direct federation</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Another scenario I recently came up with direct federation is to speed up a merge &amp; acquisition scenario. If company A is already using Azure AD and the newly acquired company B has not move to Azure AD yet you can easly achieve a quick first collaboration. My experience is, that after the deal of acquiring company B is official, granting access to some resources like intranet / documents hosted on SharePoint Online or inviting people into Microsoft Teams must be realized quickly. Depending on the size of company B just sending out hundreds or maybe thousands of classic Azure B2B invites can have a big impact to users and to the support organisation. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>With direct federation we now have now the perfect answer for onboarding company B in a blink! And the best part - we can integrate more or less everything that we may find for authenticating users with SAML2 / WS-Fed. So if company B is using ADFS - perfect; if they are strong bound to open source and linux maybe the have Shibboleth running - Check!</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":141} --></p>
<figure class="wp-block-image"><img src="{{ site.baseurl }}/assets/2019/07/image.png" alt="" class="wp-image-141" /></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>As shown above the IdP at company B can be anything that supports the protocols SAML 2.0 or WS-FED</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading --></p>
<h2>Limitations of this scenario</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Of course using direct federation as part of an integration / migration is only a small part of the puzzle. Migrations are far more complicated than just granting access to some ressources in SharePoint Online or Microsoft Teams. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>The described approach does not cover how to give access in the other direction. Of course this can also be achieved with a federation between company B and Azure AD - but this can result in some changes for the whole AuthN flow.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Email coexistence is also often something that needs to be planed carefully. Direct federation of course does not solve this. So if users from company B need to share the same domain for sending and receiving emails or you have the need for calendar sharing the approach to achieve a quick collaboration stage can be totally different. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading --></p>
<h2>Limitations for direct federation</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Direct federation is currently in public preview and Microsoft will sure change something on the way to GA. But you always should be aware what is working, and what is not. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>From my point of view the biggest challenges before you can use direct federation are:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list --></p>
<ul>
<li>The company you want to federate with does not have validated their domain via DNS with Azure AD. So if someone made some integrations to Azure AD for some of their users in the past and they validated some or all of their domains to Azure AD direct federation is maybe not the relief you where looking for. </li>
<li>If the company you want to federate with runs it's own IdP the authentication URLs must meet some criteria. The domain name for authentication must match with the authentication URL. </li>
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:paragraph --></p>
<p>Another important information you should keep in mind when setting up direct federation is that already invited B2B users from company B keep using the classic AuthN Azure B2B flow. In a classic M&amp;A scenario you will stumble across this, because it is for sure that some of the users already collaborated before ;-). The easiest way to solve this, is to delete the already invited users. But be aware: Going this path you will lose all permissions for these users. Access permissions have to be re-applied for the users that are coming through direct federation.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading --></p>
<h2>More information</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>If you want to read more about direct federation and how to set it up with ADFS you can take a look at the documentation provided by Microsoft  <a href="https://docs.microsoft.com/en-us/azure/active-directory/b2b/direct-federation">https://docs.microsoft.com/en-us/azure/active-directory/b2b/direct-federation</a> </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading --></p>
<h2>What's next?</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>In my next blog I will cover how to setup direct federation with Shibboleth and how to migrate existing Azure B2B user to Azure B2B direct federation - so stay tuned. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
