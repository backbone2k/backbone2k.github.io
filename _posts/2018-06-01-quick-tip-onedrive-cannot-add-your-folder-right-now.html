---
layout: post
title: 'Quick tip: Onedrive cannot add your folder right now'
date: 2018-06-01 17:16:06.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Office
- Quick tip
tags:
- domain
- error
- ondrive
- powershell
meta:
  _publicize_done_20172161: '1'
  _publicize_done_external: a:1:{s:7:"twitter";a:1:{i:20268272;s:57:"https://twitter.com/backbone2k/status/1002569512544333832";}}
  timeline_notification: '1527866169'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '18497953340'
  publicize_linkedin_url: https://www.linkedin.com/updates?discuss=&scope=81344172&stype=M&topic=6408335193542782976&type=U&a=VIDw
  _wpas_done_20254079: '1'
  _publicize_done_20184597: '1'
  _wpas_done_20268272: '1'
  publicize_twitter_user: backbone2k
  _oembed_e745c8b9ce9bc0395710220a8e8a6917: "{{unknown}}"
author:
  login: cbaumgartner80
  email: wordpress@treegardner.de
  display_name: cbag
  first_name: Christian
  last_name: Baumgartner
permalink: "/2018/06/01/quick-tip-onedrive-cannot-add-your-folder-right-now/"
---
<p><img class="  wp-image-108 alignnone alignright" src="{{ site.baseurl }}/assets/2018/06/onedrive_logo_and_wordmark-svg.png" alt="OneDrive_logo_and_wordmark.svg.png" width="302" height="51" />Last week I came across a problem with the Ondrive for Business NGCÂ  was throwing the error "Onedrive cannot add your folder right now"</p>
<p><img class=" size-full wp-image-113 aligncenter" src="{{ site.baseurl }}/assets/2018/06/472e7945-6cb0-4d1c-be7e-62993a6ad6f5.png" alt="472e7945-6cb0-4d1c-be7e-62993a6ad6f5" width="355" height="173" /></p>
<p>I was mislead by this error and was thinking it is client related. At the end the solution was almost to easy - for this tenant we have client restrictions for synchronization enabled. Only domain joined devices from specified domains are allowed to sync data. Some of you already know that the environment I am working in has a lot of domains, the particular domain was not included in the list.</p>
<p>You can check for the current domain GUIDs with the SharePoint Online Powershell module:</p>
<p>[code language="powershell"]Get-SPOTenantSyncClientRestriction | Select-Object -ExpandProperty AllowedDomainList</p>
<p>Guid<br />
----<br />
cd4eb0e7-c5a2-4734-afd9-931fc6dbf285<br />
ce3b35e7-394b-4a60-b317-6a5021872993<br />
63b6ced5-91c5-4672-b248-e1fba2027aa6<br />
2e4b1128-db58-4fd9-8175-590cf0fef209<br />
[/code]</p>
<p>You can add another domain to the list with</p>
<p>[code language="powershell"]<br />
$ADL = (Get-SPOTenantSyncClientRestriction).AllowedDomainList<br />
$ADL.Add((Get-ADDomain -Identity lab01.treegardner.de).ObjectGUID)</p>
<p>Set-SPOTenantSyncClientRestriction -DomainGuids $ADL</p>
<p>[/code]</p>
<p>If your list is very long (the maximum number of domain GUIDs allowed are 125!) you should check for duplicates upfront before adding the new GUID</p>
<p>[code language="powershell"]<br />
$NewGUID = (Get-ADDomain -Identity lab01.treegardner.de).ObjectGUID</p>
<p>If ($GUIDs -contains $NewGUID) {<br />
    Write-Host "The GUID $NewGUID is already in the list of allowed domains!"<br />
} Else {<br />
    $GUIDs.Add($NewGUID)<br />
}</p>
<p>[/code]</p>
<p>Another tipp I can give you if you are dealing with a lot of domains: maintain a source list in a format where you can look it up more easily. A simple CSV file should do the trick:</p>
<p>[code]domainFQDN,domainGUID,status<br />
lab01.treegardner.de,cd4eb0e7-c5a2-4734-afd9-931fc6dbf285,added<br />
domain.local,ce3b35e7-394b-4a60-b317-6a5021872993,added<br />
company.lan,63b6ced5-91c5-4672-b248-e1fba2027aa6,removed<br />
lab02.treegardner.de,2e4b1128-db58-4fd9-8175-590cf0fef209,added[/code]</p>
<p>You can than easily built your GUID list and set this for the AllowedDomainList:</p>
<p>[code language="powershell"]<br />
$Data = Import-Csv -Path .\alloweddomainlist.csv -Delimiter ','<br />
$GUIDs = @()<br />
Foreach ($Domain in $Data) {<br />
    If ($Domain.status -eq "added") {<br />
        $GUIDs += [guid]$Domain.domainGUID<br />
    }<br />
}</p>
<p>Set-SPOTenantSyncClientRestriction -DomainGuids $GUIDs[/code]</p>
<p>&nbsp;</p>
